
const questions = [
    "头痛", "神经过敏，心中不踏实", "头脑中有不必要的想法或字句盘旋", "头昏或昏倒",
    "对异性的兴趣减退", "对旁人责备求全", "感到别人能控制您的思想", "责怪别人制造麻烦",
    "忘性大", "担心自己的衣饰整齐及仪态的端正", "容易烦恼和激动", "胸痛",
    "害怕空旷的场所或街道", "感到自己的精力下降，活动减慢", "想结束自己的生命",
    "听到旁人听不到的声音", "身体发抖", "感到大多数人都不可信", "胃口不好", "容易哭泣",
    "对异性甚至不被别人理解", "感到受骗，中了圈套或有人想抓住您", "无缘无故地突然感到害怕",
    "自己不能控制地发脾气", "怕单独出门", "经常责怪自己", "腰痛", "感到难以完成任务",
    "感到孤独", "感到苦闷", "过分担忧", "对事物不感兴趣", "感到害怕", "您的感情容易受到伤害",
    "旁人能知道您的私下想法", "感到别人不理解您、同情您", "感到人们对您不友好，不喜欢您",
    "做事必须做得很慢以保证做得正确", "心跳得很厉害", "恶心或胃部不舒服", "感到比不上别人",
    "肌肉酸痛", "感到有人在监视您、谈论您", "难以入睡", "做事必须反复检查", "难以作出决定",
    "怕乘电车、公共汽车、地铁或火车", "呼吸有困难", "一阵阵发冷或发热",
    "因为感到害怕而避开某些东西、场合或活动", "脑子变空了", "身体发麻或刺痛",
    "喉咙有梗塞感", "感到没有前途没有希望", "不能集中注意力", "感到身体的某一部分软弱无力",
    "感到紧张或容易紧张", "感到手或脚发重", "想到死亡的事", "吃得太多",
    "当别人看着您或谈论您时感到不自在", "有一些不属于您自己的想法",
    "有想打人或伤害他人的冲动", "醒得太早", "必须反复洗手、点数目或触摸某些东西",
    "睡得不稳不深", "有想摔坏或破坏东西的冲动", "有一些别人没有的想法",
    "对旁人也十分介意", "在商店或电影院等人多的地方感到不自在", "感到任何事情都很难做",
    "感到身体不舒服", "感到在公共场合吃东西很不舒服", "经常与人争论", "单独一人时神经很紧张",
    "别人的所作所为极不甘心", "感到孤独即使和别人在一起", "感到坐立不安",
    "感到自己无价值", "感到熟悉的东西变成陌生或不象是真的", "大叫或摔东西",
    "害怕会在公共场合晕倒", "感到对别人不信任", "因为想做的事没做成而感到懊悔",
    "感到精力太对了", "感到难以集中精力", "感到对性生活不感兴趣", "感到这一辈子受了不少罪",
    "感到要很快把事情做完", "感到自己的身体有严重问题"
];

// 因子归属 (基于 1-90 题号，需减 1 转 0-based index)
const factors = {
    "躯体化": [0, 3, 11, 26, 39, 41, 47, 48, 51, 52, 55, 57],
    "强迫症状": [2, 8, 9, 27, 37, 44, 45, 50, 54, 64],
    "人际关系敏感": [5, 20, 33, 35, 36, 40, 60, 68, 72],
    "抑郁": [4, 13, 14, 19, 21, 25, 28, 29, 30, 31, 53, 70, 78],
    "焦虑": [1, 16, 22, 32, 38, 56, 71, 77, 79, 85],
    "敌对": [10, 23, 62, 66, 73, 80],
    "恐怖": [12, 24, 46, 49, 69, 74, 81],
    "偏执": [7, 17, 42, 67, 75, 82],
    "精神病性": [6, 15, 34, 61, 76, 83, 84, 86, 87, 89],
    "其他": [18, 43, 58, 59, 63, 65, 88]
};

// 预定义精选子集，确保覆盖核心因子
// 15题版：挑选各因子的代表性高分项
const subset15 = [
    0,  // 头痛 (躯体化)
    1,  // 神经过敏 (焦虑)
    14, // 想结束生命 (抑郁-核心)
    20, // 感到不被理解 (人际)
    23, // 容易发脾气 (敌对)
    28, // 感到孤独 (抑郁)
    38, // 心跳厉害 (焦虑/躯体)
    43, // 难以入睡 (其他/睡眠)
    45, // 难以做决定 (强迫)
    60, // 感到不自在 (人际)
    65, // 睡不稳 (其他/睡眠)
    66, // 想摔东西 (敌对)
    72, // 感到自卑 (人际)
    78, // 感到受罪 (抑郁)
    85, // 感到要赶快做事 (焦虑/强迫)
];

// 50题版：保留核心因子的50%-60%题目
const subset50 = [
    0, 1, 2, 4, 9, 11, 12, 13, 14, 16,
    19, 20, 21, 23, 24, 26, 27, 28, 29, 30,
    31, 32, 33, 36, 37, 38, 41, 43, 45, 48,
    51, 52, 53, 55, 59, 60, 64, 65, 66, 68,
    70, 71, 72, 77, 78, 79, 81, 85, 86, 88
];

export const scl90Data = {
    id: "scl90",
    title: "SCL-90 症状自评量表",
    description: "世界上最著名的心理健康测试量表之一，包含90个项目，全面评估您的心理健康状况。",
    questions: questions.map((text, index) => ({
        id: `q${index + 1}`,
        text: `${text}`, // 移除题号前缀，由UI控制显示
        options: [
            { score: 1, text: "没有" },
            { score: 2, text: "很轻" },
            { score: 3, text: "中等" },
            { score: 4, text: "偏重" },
            { score: 5, text: "严重" }
        ]
    })),
    subset15,
    subset50,
    factorDescriptions: {
        "躯体化": "身体不适感，如头痛、背痛、肌肉酸痛等。",
        "强迫症状": "明知没必要但无法摆脱的无意义思想、冲动或行为。",
        "人际关系敏感": "与人相处时的不自在感和自卑感。",
        "抑郁": "苦闷、失望、悲观、缺乏动力和生活兴趣。",
        "焦虑": "游离不定的紧张、烦躁、坐立不安及惊恐发作。",
        "敌对": "容易厌烦、争论、摔物或不可控制的脾气爆发。",
        "恐怖": "对特定对象或情境（如广场、高处、社交）的非理性恐惧。",
        "偏执": "多疑、敌对、投射性思维或感觉被针。",
        "精神病性": "幻听、被控制感或思维播散等（需专业鉴别）。",
        "其他": "主要反映睡眠及饮食情况。"
    }
};

// Helper for warm intros
const getWarmIntro = (avgScore, highFactors) => {
    if (avgScore < 1.5) {
        return "亲爱的，看到这份答卷，仿佛看到阳光洒在平静的湖面上。在这个充满喧嚣和不确定的世界里，你依然保持着难得的内心安宁与通透。你不仅把自己照顾得很好，或许还是身边人的小太阳。但这并不意味着你必须时刻坚强，偶尔的疲惫也是允许的，继续带着这份温暖的光芒前行吧，你真的很棒！";
    } else if (avgScore < 2.5) {
        return "抱抱你，亲爱的。最近是不是感觉肩上的担子有点重？像是独自走在一条有些漫长的夜路上，虽然还能坚持，但心里偶尔也会觉得疲惫和无助吧。你的那些隐忍和努力，其实身体和情绪都看在眼里。这并不是你的软弱，而是提醒你需要停下来，给自己一个温柔的拥抱，允许自己偶尔的不完美，好吗？";
    } else {
        return "亲爱的，此刻我真的很想隔着屏幕给你一个大大的拥抱。最近这段时间，你一定过得很辛苦吧？那些深夜里的辗转反侧，那些无法言说的压抑和焦虑，真的让你承受了太多。请不要责怪自己，也不要觉得孤单，这些情绪只是受伤的内心在发出求救信号。你已经撑得很久了，现在，试着放下防备，让我们陪你一起面对，好吗？";
    }
};

// Healing Prescriptions (Solutions)
// This is now legacy/secondary if we use factorAnalysisData, but kept for the "Top 2" feature
const healingGuides = {
    "焦虑": {
        title: "给焦虑的你：按下暂停键",
        content: "亲爱的，我知道此刻你的脑海里可能像有一场风暴，担心着很多未发生的事情。试着做这个练习：\n\n1. **4-7-8 呼吸法**：吸气4秒，憋气7秒，呼气8秒。重复4次。这能强制让副交感神经兴奋，降低心率。\n2. **着陆练习**：环顾四周，说出5样你能看到的东西，4样你能摸到的，3样你能听到的，2样你能闻到的，1样你能尝到的。这能把你拉回当下。\n3. **接纳而非对抗**：告诉自己“我现在感到焦虑，这没关系，它只是一种情绪，像云一样会飘走”。"
    },
    "抑郁": {
        title: "给低落的你：微小的光亮",
        content: "如果感觉世界是灰色的，连起床都需要巨大的力气，请不要自责。这只是心灵感冒了。\n\n1. **像对待生病的朋友一样对待自己**：允许自己休息，允许自己什么都不做。\n2. **微行动**：今天只定一个目标，比如“喝一杯温水”或“晒5分钟太阳”。完成了就大大地夸奖自己。\n3. **书写疗愈**：不需要文采，拿出纸笔，把心里的堵塞都写出来，或者画出来，让情绪流淌出去。"
    },
    "躯体化": {
        title: "给身体的对话：倾听信号",
        content: "身体的不适往往是情绪的替身。它在用疼痛或不适大声说话，想让你听见它的需求。\n\n1. **身体扫描**：闭上眼，从脚趾开始慢慢向上扫描全身，感受哪里紧张，试着对着那个部位呼气，说声“辛苦了”。\n2. **温和运动**：做一些瑜伽或散步，帮助身体释放积压的压力荷尔蒙。\n3. **规律作息**：身体喜欢秩序感，尽量固定睡觉和吃饭的时间。"
    },
    "强迫症状": {
        title: "给紧绷的你：允许不确定",
        content: "那些反复出现的念头一定让你很累吧。试着练习“与不确定性共处”。\n\n1. **推迟刻板行为**：当想反复检查时，告诉自己“我可以检查，但我等15分钟再做”。往往冲动会减弱。\n2. **区分想法与事实**：脑子里的念头只是念头，不代表它就是事实。比如“我没锁门”只是一个念头，不代表真的没锁。\n3. **正念观察**：想象这些念头是河面上的落叶，你只是坐在岸边看着它们漂过，不用去捞它。"
    },
    "人际关系敏感": {
        title: "给敏感的你：你很珍贵",
        content: "对他人的眼神和言语过于敏感，是因为你太渴望被接纳了。但请记得，你不需要讨好任何人。\n\n1. **课题分离**：别人的情绪是别人的课题，不是你的错。你不需要为他人的不开心负责。\n2. **自我肯定**：每天对着镜子找出一个自己的优点，大声说出来。\n3. **建立边界**：学会温柔而坚定地说“不”。保护自己的能量，这不是自私，是自爱。"
    },
    "敌对": {
        title: "给易怒的你：拥抱内心的火",
        content: "愤怒往往是受了伤的自我保护。它在说：“我不喜欢这样，我要保护自己。”\n\n1. **暂停6秒**：愤怒冲上头顶时，默数6秒。这能让大脑皮层重新接管控制权。\n2. **健康的宣泄**：去跑步、打枕头、或者在一个没人的地方大喊。不要把攻击指向自己或他人。\n3. **探究源头**：问问自己，愤怒背后，我是不是感到委屈、被忽视或被侵犯了？"
    },
    "恐怖": {
        title: "给恐惧的你：建立安全岛",
        content: "害怕是人类最古老的生存本能。不需要立刻克服它，我们可以先安抚它。\n\n1. **建立安全岛**：在脑海里构建一个绝对安全的地方（比如外婆的怀抱、海边的小屋），感到害怕时就躲进去。\n2. **系统脱敏**：如果害怕某个场景，先在想象中接触它，保持放松，慢慢适应。\n3. **寻求陪伴**：不要独自面对巨大的恐惧，找信任的人握住你的手。"
    },
    "偏执": {
        title: "给多疑的你：重建信任",
        content: "这种感觉一定很孤单吧。试着打开一点点心门。\n\n1. **现实检验**：当怀疑别人针对自己时，问问自己“有确凿的证据吗？有没有其他的解释？”\n2. **小步尝试**：试着给身边值得信任的人一点点信任，观察反馈，慢慢积累正向经验。\n3. **专注当下**：多关注当下的具体事情，少在这个人的动机上做过多的联想。"
    },
    "精神病性": {
        title: "给困惑的你：锚定现实",
        content: "如果在感知现实上感到困难，请务必寻求专业的精神科医生帮助。这就像身体生病一样，需要吃药治疗。\n\n1. **规律生活**：保持绝对规律的饮食和睡眠，这是精神稳定的基石。\n2. **避免刺激**：少接触恐怖、刺激的信息，远离酒精和毒品。\n3. **专业支持**：这并非靠意志力能解决的，请信任医生和科学的方案。"
    },
    "其他": {
        title: "给特别的你：照顾好饮食睡眠",
        content: "虽然没有突出的某一方面，但睡眠和饮食的基础如果动摇，也会让人身心俱疲。\n\n1. **睡前仪式**：洗个热水澡，喝杯热牛奶，远离手机。\n2. **正念进食**：吃饭时专心吃饭，细嚼慢咽，感受食物的味道。\n3. **接触自然**：去公园走走，抱抱大树，大自然有天然的疗愈力。"
    }
};

// Comprehensive Factor Analysis Data
const factorAnalysisData = {
    "躯体化": {
        low: {
            status: "身心轻盈",
            insight: "当下的你，身体像是一台运转良好的精密仪器，没有发出太多嘈杂的信号。这说明你很懂得照顾自己的起居，你是自己身体最好的守护者。",
            suggestion: "保持这种对身体的觉察，继续享受运动和美食带来的快乐吧。"
        },
        high: {
            status: "身体在说话",
            insight: "最近身体是不是在用一些小疼痛、不舒服来引起你的注意？这些“症状”其实是身体在替无法表达的情绪喊累。它在说：“亲爱的，我需要休息。”",
            suggestion: "试着每天花10分钟做一次“身体扫描”冥想，温柔地询问那个不舒服的部位：“你需要我为你做些什么？”别无视它的求救。"
        }
    },
    "强迫症状": {
        low: {
            status: "思维流畅",
            insight: "你的大脑像一条欢快流动的小溪，念头来来去去，不会在某块石头上死磕。这种灵活的思维方式，让你在生活中能更轻松地翻篇。",
            suggestion: "继续保持这种“允许一切发生”的松弛感，这是非常宝贵的心理资源。"
        },
        high: {
            status: "紧绷的发条",
            insight: "脑海里是不是总有一个严厉的教官，逼着你反复检查、反复确认？我知道你只是想把事情做对、想从不确定性中通过控制找回一点安全感，但这真的让你很累吧。",
            suggestion: "试着练习“有的放矢的粗心”。每天选一件无关紧要的小事，故意做得不那么完美，然后观察：天并没有塌下来，对吗？"
        }
    },
    "人际关系敏感": {
        low: {
            status: "自在从容",
            insight: "在人群中，你像一棵舒展的树，既不刻意迎合，也不过度防御。你能看见他人的美好，也深深地接纳自己的存在。",
            suggestion: "你的这份从容会感染身边的人，继续做那个真实的自己就好。"
        },
        high: {
            status: "带刺的玫瑰",
            insight: "你是不是总觉得别人话里有话，或者担心自己不够好、会被拒绝？这种敏感像没有皮肤的伤口，风吹草动都会痛。其实，这只是因为你太在乎连接，太渴望被爱了。",
            suggestion: "记住“课题分离”：别人的情绪是别人的事，不一定与你有关。每天对着镜子练习说一遍：“无论别人怎么看，我都值得被爱。”"
        }
    },
    "抑郁": {
        low: {
            status: "心中有光",
            insight: "你的内心充满了生命的活力，即使遇到阴雨天，你也知道太阳总会出来。这种对抗挫折的心理韧性，是你最强大的武器。",
            suggestion: "将你的快乐分享给更多人吧，你是人群中的小太阳。"
        },
        high: {
            status: "蓝色潮汐",
            insight: "最近是不是觉得心里空空的，连快乐都像隔了一层玻璃？这种无力感不是因为你懒惰或矫情，只是你的心灵能量暂时耗尽了，它需要一场漫长的冬眠。",
            suggestion: "不要强迫自己“好起来”。允许自己像植物一样只需发呆和呼吸。每天只做一件让自己稍微舒服一点点的小事，这就够了。"
        }
    },
    "焦虑": {
        low: {
            status: "宁静港湾",
            insight: "面对未来的不确定，你依然能稳稳地坐在当下。这份内心的秩序感，让你在纷扰的世界中拥有了自己的定海神针。",
            suggestion: "享受当下的宁静，这是一种即使外界兵荒马乱也能内心安然的能力。"
        },
        high: {
            status: "暴风前夜",
            insight: "你的脑海里是不是时刻在上演着“如果……怎么办”的灾难片？这种紧绷感是为了应对未知的危险，但一直拉警报会让心灵过载。亲爱的，未来没那么可怕。",
            suggestion: "当焦虑来袭，试着做“54321着陆练习”：找5个能看到的、4个能摸到的、3个能听到的东西。把感官拉回此时此刻。"
        }
    },
    "敌对": {
        low: {
            status: "平和包容",
            insight: "你拥有一颗宽广的心，能理解他人的局限，也不易被愤怒裹挟。这份平和不仅善待了他人，更是放过了自己。",
            suggestion: "继续用温柔的眼光看世界，世界也会温柔待你。"
        },
        high: {
            status: "愤怒的小鸟",
            insight: "是不是经常感觉一股无名火直冲脑门？这股愤怒其实是受伤的自我保护色，它在替你大喊：“我不喜欢被这样对待！我有我的底线！”",
            suggestion: "愤怒没有错，但别让它烧伤自己。试着在生气的当下，深呼吸6秒，然后问问自己：“让我愤怒的背后，我是不是感到委屈或被忽视了？”"
        }
    },
    "恐怖": {
        low: {
            status: "勇敢探索",
            insight: "你对世界充满了好奇与信任，那些能吓退别人的场景，对你来说只是生活的小插曲。你拥有很强的安全感底色。",
            suggestion: "带着这份勇气，去探索更广阔的世界吧。"
        },
        high: {
            status: "受惊的小鹿",
            insight: "某些特定的场合或东西是不是让你想立刻逃跑？这种恐惧感是真实的，也是也是身体想保护你。不必逼自己立刻克服，我们慢慢来。",
            suggestion: "不需要强行面对。试着在脑海里建立一个“安全岛”（比如温暖的被窝），感到害怕时，先躲进去给自己充充电。"
        }
    },
    "偏执": {
        low: {
            status: "信任开放",
            insight: "你愿意相信他人的善意，也能客观地看待分歧。这种信任的能力，让你的人际关系简单而清爽。",
            suggestion: "保持这份对他人的信任，它是连接心与心的桥梁。"
        },
        high: {
            status: "警惕雷达",
            insight: "你是不是总觉得周围的人别有用心，或者世界充满了敌意？这种时刻开启的防御雷达，是为了不让自己受伤，但由于由于长期紧绷，心门也随之关闭了。",
            suggestion: "试着进行“现实检验”：当怀疑产生时，问自己“有确凿的证据吗？还是我在猜想？”尝试给值得的人多一点点信任，看看会发生什么。"
        }
    },
    "精神病性": {
        low: {
            status: "现实稳固",
            insight: "你稳稳地扎根于现实大地，思维清晰，逻辑连贯。这说明你的精神地基非常牢固。",
            suggestion: "规律的作息是维持这一状态的基石，继续保持。"
        },
        high: {
            status: "迷雾森林",
            insight: "最近是不是感觉现实有些不真实，或者脑子里有些不受控制的想法？这就像大脑里的信号接收器出现了一点杂音。这并不代表你“疯了”，只是需要专业的调试。",
            suggestion: "这种情况依靠意志力很难调整。请务必寻求专业精神科医生的帮助，就像感冒看医生一样自然。药物和专业治疗能帮你拨开迷雾。"
        }
    },
    "其他": {
        low: {
            status: "生活规律",
            insight: "你的睡眠和饮食习惯良好，这为你的心理健康提供了最坚实的生理基础。能吃能睡，是最大的福气。",
            suggestion: "身体是革命的本钱，继续善待它。"
        },
        high: {
            status: "生活失序",
            insight: "是不是最近睡不好觉，或者胃口变差了？这些基础生理机能的波动，往往是心理压力的风向标。身体在亮红灯了。",
            suggestion: "先把心理问题放一放，优先解决“睡”和“吃”。睡前泡个脚，听听白噪音，先把身体的电量充上来，心情自然会好转。"
        }
    }
};

export const calculateSCL90Result = (scores) => {
    // scores is { q1: 1, q2: 3 ... }
    let totalScore = 0;
    let factorScores = {};

    // Initialize factor scores
    const factors = {
        "躯体化": [0, 3, 11, 26, 39, 41, 47, 48, 51, 52, 55, 57],
        "强迫症状": [2, 8, 9, 27, 37, 44, 45, 50, 54, 64],
        "人际关系敏感": [5, 20, 33, 35, 36, 40, 60, 68, 72],
        "抑郁": [4, 13, 14, 19, 21, 25, 28, 29, 30, 31, 53, 70, 78],
        "焦虑": [1, 16, 22, 32, 38, 56, 71, 77, 79, 85],
        "敌对": [10, 23, 62, 66, 73, 80],
        "恐怖": [12, 24, 46, 49, 69, 74, 81],
        "偏执": [7, 17, 42, 67, 75, 82],
        "精神病性": [6, 15, 34, 61, 76, 83, 84, 86, 87, 89],
        "其他": [18, 43, 58, 59, 63, 65, 88]
    };

    Object.keys(factors).forEach(f => factorScores[f] = { sum: 0, count: 0, avg: 0 });

    let validQuestionCount = 0;

    Object.entries(scores).forEach(([qid, score]) => {
        totalScore += score;
        validQuestionCount++;
        const qIndex = parseInt(qid.replace('q', '')) - 1; // 0-based index

        // Check which factor this question belongs to
        Object.entries(factors).forEach(([factorName, qIds]) => {
            if (qIds.includes(qIndex)) {
                factorScores[factorName].sum += score;
                factorScores[factorName].count += 1;
            }
        });
    });

    // Calculate averages
    Object.keys(factorScores).forEach(f => {
        if (factorScores[f].count > 0) {
            factorScores[f].avg = (factorScores[f].sum / factorScores[f].count).toFixed(2);
        } else {
            factorScores[f].avg = 0; // Or "N/A"
        }
    });

    const totalAvg = validQuestionCount > 0 ? (totalScore / validQuestionCount).toFixed(2) : 0;

    // Detailed Clinical Analysis
    let detailedAnalysis = "";
    const positiveCount = Object.values(scores).filter(s => s >= 2).length;

    // Find highest factors with meaningful data
    const highFactors = Object.entries(factorScores)
        .filter(([_, data]) => data.count > 0 && data.avg >= 2)
        .sort((a, b) => b[1].avg - a[1].avg) // Sort by severity
        .slice(0, 3) // Top 3
        .map(([name]) => name);

    // Generate Healing Plans (Legacy, can be kept or removed if comprehensive is used)
    let healingPlan = [];
    if (highFactors.length > 0) {
        highFactors.slice(0, 2).forEach(factorName => {
            if (healingGuides[factorName]) {
                healingPlan.push(healingGuides[factorName]);
            }
        });
    } else {
        healingPlan.push({
            title: "致健康的你：保持心的弹性",
            content: "你的状态令人羡慕，但生活总有起伏。保持觉察，找到属于自己的“能量加油站”（比如运动、阅读或与朋友聚会）。当风雨来袭时，这把伞会为你遮挡。"
        });
    }

    // Generate Comprehensive Factor Analysis
    const comprehensiveAnalysis = Object.entries(factorScores)
        .filter(([_, data]) => data.count > 0)
        .map(([name, data]) => {
            const score = parseFloat(data.avg);
            const isHigh = score >= 2;
            const dataPoint = factorAnalysisData[name] ? (isHigh ? factorAnalysisData[name].high : factorAnalysisData[name].low) : null;

            return {
                factor: name,
                score: score,
                status: dataPoint ? dataPoint.status : (isHigh ? "需关注" : "良好"),
                insight: dataPoint ? dataPoint.insight : "",
                suggestion: dataPoint ? dataPoint.suggestion : ""
            };
        });


    if (totalAvg >= 2 || positiveCount > (validQuestionCount / 2)) {
        detailedAnalysis = "从临床心理学角度分析，您的心理状态目前处于【需关注】区间。这意味着近期的压力或情绪困扰已经开始影响您的日常生活。";
        if (highFactors.length > 0) {
            detailedAnalysis += `\n\n主要风险因子集中在：【${highFactors.join('、')}】。\n这表明您可能正在经历${highFactors[0]}带来的困扰，建议结合具体的因子得分图谱，查看详细的症状表现，必要时寻求专业心理咨询师的帮助。`;
        } else {
            detailedAnalysis += "\n\n症状分布较为发散，没有呈现出单一维度的显著突出，这可能与长期的慢性压力有关。建议进行全面的身心调整。";
        }
    } else {
        detailedAnalysis = "从临床心理学角度分析，您的各项心理指标均在正常范围内，整体心理韧性较好。";
        if (totalAvg > 1.5) {
            detailedAnalysis += "\n\n虽然未达到临床预警线，但部分指标显示出轻微的波动。这通常是面对生活压力时的正常应激反应，通过适当的休息和自我调节即可恢复。";
        } else {
            detailedAnalysis += "\n\n您的心理防御机制运作良好，能够有效地应对生活中的挑战。继续保持当前的积极心态和生活方式即可。";
        }
    }

    return {
        level: totalAvg >= 2 ? "需关注" : "健康",
        totalScore,
        totalAvg,
        factorScores,
        warmIntro: getWarmIntro(totalAvg),
        detailedAnalysis,
        healingPlan,
        comprehensiveAnalysis // New field
    };
};
